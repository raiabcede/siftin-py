<!DOCTYPE html>
<html lang="en" dir="ltr" data-color-theme="Green_Theme" class="selected"
	data-layout="vertical" data-boxed-layout="full" data-card="shadow">

	<head>
		@@include("../partials/head.html")
		<title>Results - Siftin</title>
	</head>

	<body class="DEFAULT_THEME  bg-white dark:bg-dark">
		<main>
			<!--start the project-->
			<div id="main-wrapper" class="flex">

				<aside id="application-sidebar-brand"
					class="hs-overlay hs-overlay-open:translate-x-0 -translate-x-full xl:rtl:-translate-x-0 rtl:translate-x-full  left-0 rtl:left-auto rtl:right-0 transform hidden xl:block xl:translate-x-0 xl:end-auto xl:bottom-0 fixed top-0 with-vertical  left-sidebar transition-all duration-300 h-screen z-[2] flex-shrink-0 border-r rtl:border-l rtl:border-r-0 w-[270px] border-border dark:border-darkborder bg-white dark:bg-dark">
					@@include("../partials/sidebar.html",{ "page": "results" })
				</aside>
				<div class="page-wrapper w-full" role="main">
					<!--  Header Start -->
					<header
						class="sticky top-header top-0 inset-x-0 z-[1] flex flex-wrap md:justify-start md:flex-nowrap text-sm bg-white dark:bg-dark ">
					<div
						class="with-vertical w-full">@@include("../partials/header.html")</div>
					<div class="with-horizontal w-full">
						<div class="bg-white dark:bg-dark shadow-md dark:shadow-dark-md">
							<div class="container">
								@@include("../partials/horizontal-header.html")
							</div>
						</div>
					</div>
					</header>
					<!--  Header End -->

					<!-- Horizontal Header Menu -->
					<aside class="with-horizontal lg:flex hidden">
						@@include("../partials/horizontal-sidebar.html", { "page": "results",
						})
					</aside>
					<!-- Horizontal Header Menu End -->

					<!-- Main Content -->
					<main class="h-full max-w-full pt-6">
						<div class="container full-container py-5">
							<!-- Page Title and Info -->
							<div class="mb-6">
								<div class="flex items-center gap-3 mb-4">
									<h1 class="text-3xl font-bold text-dark dark:text-white">Results</h1>
									<span class="px-3 py-1 text-sm font-medium rounded-md bg-lightsuccess dark:bg-darksuccess text-success">
										Completed
									</span>
								</div>
								
								<!-- Source and Criteria Info -->
								<div class="mb-4 space-y-2">
									<div class="flex items-center gap-2 text-sm">
										<span class="text-link dark:text-darklink">Source:</span>
										<span class="text-dark dark:text-white" id="result-source">https://www.linkedin.com/search/results/peopl...</span>
										<button onclick="copySource()" class="text-link dark:text-darklink hover:text-primary">
											<i class="ti ti-copy text-sm"></i>
										</button>
									</div>
									<div class="flex items-center gap-2 text-sm">
										<span class="text-link dark:text-darklink">Created:</span>
										<span class="text-dark dark:text-white" id="result-created">Jan 15, 2024 10:30 PM</span>
									</div>
									<div class="flex items-center gap-2 text-sm">
										<span class="text-link dark:text-darklink">Criteria:</span>
										<span class="text-dark dark:text-white" id="result-criteria">SDR managers at SaaS companies in the US w...</span>
									</div>
								</div>

								<!-- Action Buttons -->
								<div class="flex items-center gap-3 mb-6">
									<button class="btn btn-outline btn-sm">
										<i class="ti ti-device-floppy mr-2"></i> Save View
									</button>
									<button class="btn btn-outline btn-sm">
										<i class="ti ti-download mr-2"></i> Export
									</button>
									<button class="btn btn-outline btn-sm">
										<i class="ti ti-send mr-2"></i> Send to CRM
									</button>
									<button class="btn btn-outline btn-sm">
										<i class="ti ti-dots"></i>
									</button>
								</div>

								<!-- Introductory Text Block -->
								<div id="intro-block" class="bg-lightinfo dark:bg-darkinfo border border-primary/20 rounded-md p-4 mb-6 relative">
									<button onclick="closeIntroBlock()" class="absolute top-3 right-3 text-link dark:text-darklink hover:text-primary">
										<i class="ti ti-x"></i>
									</button>
									<h3 class="text-lg font-semibold text-dark dark:text-white mb-2">
										Instantly know if a lead is a good fit without researching them
									</h3>
									<p class="text-sm text-link dark:text-darklink mb-3">
										SIFTIN automatically finds and adds key data points to prospects, so you can focus on what matters—closing deals.
									</p>
									<ul class="space-y-1 text-sm text-link dark:text-darklink">
										<li class="flex items-center gap-2">
											<i class="ti ti-check text-success"></i>
											<span>Crucial company data, added automatically.</span>
										</li>
										<li class="flex items-center gap-2">
											<i class="ti ti-check text-success"></i>
											<span>Filter your leads with laser precision.</span>
										</li>
										<li class="flex items-center gap-2">
											<i class="ti ti-check text-success"></i>
											<span>Personalize your messages with real data.</span>
										</li>
										<li class="flex items-center gap-2">
											<i class="ti ti-check text-success"></i>
											<span>See everything in one place.</span>
										</li>
									</ul>
								</div>
							</div>

							<!-- Filters and Results Section -->
							<div class="flex gap-6">
								<!-- Left Sidebar - Filters -->
								<aside class="w-64 flex-shrink-0">
									<div class="card sticky top-24">
										<div class="card-body space-y-6">
											<!-- Search -->
											<div>
												<input 
													type="text" 
													id="search-input"
													placeholder="Search name, title, company..." 
													class="w-full px-4 py-2 border border-border dark:border-darkborder rounded-md bg-white dark:bg-dark text-dark dark:text-white focus:outline-none focus:ring-2 focus:ring-primary"
												/>
											</div>

											<!-- Quick Filters -->
											<div>
												<h3 class="text-sm font-semibold text-dark dark:text-white mb-3">Quick Filters</h3>
												<div class="flex flex-wrap gap-2">
													<button onclick="toggleQuickFilter('good-fit')" class="quick-filter-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-filter="good-fit">
														Good Fit (≥80)
													</button>
													<button onclick="toggleQuickFilter('us-only')" class="quick-filter-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-filter="us-only">
														US Only
													</button>
													<button onclick="toggleQuickFilter('smb')" class="quick-filter-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-filter="smb">
														SMB (11-200)
													</button>
													<button onclick="toggleQuickFilter('enterprise')" class="quick-filter-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-filter="enterprise">
														Enterprise (1,001+)
													</button>
												</div>
											</div>

											<!-- Company Size -->
											<div>
												<h3 class="text-sm font-semibold text-dark dark:text-white mb-3">Company Size</h3>
												<div class="flex flex-wrap gap-2">
													<button onclick="toggleCompanySize('1-10')" class="company-size-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-size="1-10">
														1-10
													</button>
													<button onclick="toggleCompanySize('11-50')" class="company-size-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-size="11-50">
														11-50
													</button>
													<button onclick="toggleCompanySize('51-200')" class="company-size-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-size="51-200">
														51-200
													</button>
													<button onclick="toggleCompanySize('201-500')" class="company-size-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-size="201-500">
														201-500
													</button>
													<button onclick="toggleCompanySize('501-1000')" class="company-size-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-size="501-1000">
														501-1,000
													</button>
													<button onclick="toggleCompanySize('1001-5000')" class="company-size-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-size="1001-5000">
														1,001-5,000
													</button>
													<button onclick="toggleCompanySize('5001+')" class="company-size-btn px-3 py-1.5 text-xs border border-border dark:border-darkborder rounded-md hover:border-primary dark:hover:border-primary transition-colors" data-size="5001+">
														5,001+
													</button>
												</div>
											</div>

											<!-- Match Score -->
											<div>
												<div class="flex items-center justify-between mb-2">
													<h3 class="text-sm font-semibold text-dark dark:text-white">Match Score</h3>
													<span class="text-xs text-link dark:text-darklink" id="match-score-value">≥ 0</span>
												</div>
												<input 
													type="range" 
													id="match-score-slider"
													min="0" 
													max="100" 
													value="0" 
													class="w-full h-2 bg-gray-200 dark:bg-darkborder rounded-lg appearance-none cursor-pointer accent-primary"
													oninput="updateMatchScore(this.value)"
												/>
											</div>

											<!-- Industry -->
											<div>
												<h3 class="text-sm font-semibold text-dark dark:text-white mb-3">Industry</h3>
												<div class="space-y-2 max-h-48 overflow-y-auto">
													<label class="flex items-center gap-2 cursor-pointer">
														<input type="checkbox" class="industry-checkbox" value="SaaS" onchange="applyFilters()">
														<span class="text-sm text-link dark:text-darklink">SaaS</span>
													</label>
													<label class="flex items-center gap-2 cursor-pointer">
														<input type="checkbox" class="industry-checkbox" value="Fintech SaaS" onchange="applyFilters()">
														<span class="text-sm text-link dark:text-darklink">Fintech SaaS</span>
													</label>
													<label class="flex items-center gap-2 cursor-pointer">
														<input type="checkbox" class="industry-checkbox" value="Enterprise Software" onchange="applyFilters()">
														<span class="text-sm text-link dark:text-darklink">Enterprise Software</span>
													</label>
													<label class="flex items-center gap-2 cursor-pointer">
														<input type="checkbox" class="industry-checkbox" value="Data Analytics" onchange="applyFilters()">
														<span class="text-sm text-link dark:text-darklink">Data Analytics</span>
													</label>
													<label class="flex items-center gap-2 cursor-pointer">
														<input type="checkbox" class="industry-checkbox" value="Cloud Infrastructure" onchange="applyFilters()">
														<span class="text-sm text-link dark:text-darklink">Cloud Infrastructure</span>
													</label>
													<label class="flex items-center gap-2 cursor-pointer">
														<input type="checkbox" class="industry-checkbox" value="Marketing Tech" onchange="applyFilters()">
														<span class="text-sm text-link dark:text-darklink">Marketing Tech</span>
													</label>
												</div>
											</div>

											<!-- Location -->
											<div>
												<h3 class="text-sm font-semibold text-dark dark:text-white mb-2">Location</h3>
												<input 
													type="text" 
													id="location-input"
													placeholder="Country, state, city" 
													class="w-full px-4 py-2 border border-border dark:border-darkborder rounded-md bg-white dark:bg-dark text-dark dark:text-white focus:outline-none focus:ring-2 focus:ring-primary"
												/>
											</div>

											<!-- Reset Filters -->
											<div>
												<button onclick="resetAllFilters()" class="text-sm text-primary hover:underline">
													Reset all filters
												</button>
											</div>
										</div>
									</div>
								</aside>

								<!-- Main Content Area -->
								<div class="flex-1">
									<!-- Results Header -->
									<div class="flex items-center justify-between mb-4">
										<div class="flex items-center gap-4">
											<span class="text-sm text-link dark:text-darklink" id="results-count">0 results • 0 selected</span>
										</div>
										<div class="flex items-center gap-4">
											<!-- View Toggle -->
											<div class="flex items-center gap-2 border border-border dark:border-darkborder rounded-md p-1">
												<button onclick="setView('table')" id="view-table-btn" class="px-3 py-1.5 text-xs font-medium rounded bg-primary text-white">
													Table
												</button>
												<button onclick="setView('cards')" id="view-cards-btn" class="px-3 py-1.5 text-xs font-medium rounded text-link dark:text-darklink hover:bg-lightprimary dark:hover:bg-darkprimary">
													Cards
												</button>
											</div>
											<!-- Sort Dropdown -->
											<select id="sort-select" onchange="applyFilters()" class="px-3 py-1.5 text-sm border border-border dark:border-darkborder rounded-md bg-white dark:bg-dark text-dark dark:text-white focus:outline-none focus:ring-2 focus:ring-primary">
												<option value="match-high">Match score (high to low)</option>
												<option value="match-low">Match score (low to high)</option>
												<option value="name-asc">Name (A-Z)</option>
												<option value="name-desc">Name (Z-A)</option>
												<option value="company-asc">Company (A-Z)</option>
												<option value="company-desc">Company (Z-A)</option>
											</select>
											<!-- Action Buttons -->
											<button onclick="selectAll()" class="btn btn-outline btn-sm">
												Select All
											</button>
											<button onclick="tagSelected()" class="btn btn-outline btn-sm">
												<i class="ti ti-tag mr-2"></i> Tag
											</button>
										</div>
									</div>

									<!-- Results Table -->
									<div id="table-view" class="card">
										<div class="card-body p-0">
											<div class="overflow-x-auto">
												<table class="w-full">
													<thead class="bg-lightprimary dark:bg-darkprimary">
														<tr>
															<th class="px-4 py-3 text-left">
																<input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll(this.checked)">
															</th>
															<th class="px-4 py-3 text-left text-xs font-semibold text-dark dark:text-white uppercase">NAME</th>
															<th class="px-4 py-3 text-left text-xs font-semibold text-dark dark:text-white uppercase">TITLE</th>
															<th class="px-4 py-3 text-left text-xs font-semibold text-dark dark:text-white uppercase">COMPANY</th>
															<th class="px-4 py-3 text-left text-xs font-semibold text-dark dark:text-white uppercase">SIZE</th>
															<th class="px-4 py-3 text-left text-xs font-semibold text-dark dark:text-white uppercase">INDUSTRY</th>
															<th class="px-4 py-3 text-left text-xs font-semibold text-dark dark:text-white uppercase">LOCATION</th>
															<th class="px-4 py-3 text-left text-xs font-semibold text-dark dark:text-white uppercase">MATCH</th>
															<th class="px-4 py-3 text-left text-xs font-semibold text-dark dark:text-white uppercase">LINKEDIN</th>
														</tr>
													</thead>
													<tbody id="results-table-body" class="divide-y divide-border dark:divide-darkborder">
														<!-- Results will be dynamically inserted here -->
													</tbody>
												</table>
											</div>
										</div>
									</div>

									<!-- Results Cards View -->
									<div id="cards-view" class="hidden">
										<div id="results-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
											<!-- Cards will be dynamically inserted here -->
										</div>
									</div>

									<!-- Empty State -->
									<div id="empty-state" class="hidden">
										<div class="card">
											<div class="card-body text-center py-12">
												<i class="ti ti-search text-6xl text-link dark:text-darklink mb-4 opacity-50"></i>
												<h3 class="text-xl font-semibold text-dark dark:text-white mb-2">No results found</h3>
												<p class="text-link dark:text-darklink">Try adjusting your filters or search criteria.</p>
											</div>
										</div>
									</div>
								</div>
							</div>

						</div>
					</main>
					<!-- Main Content End -->

				</div>
			</div>
			<!--end of project-->
		</main>
		@@include("../partials/header-components/mobile-menu.html")
		@@include("../partials/header-components/dd-searchbar.html")
		@@include("../partials/header-components/dd-cart.html")
		@@include("../partials/customizer.html")
		@@include("../partials/scripts.html")
		
		<script>
			// API Configuration
			const API_BASE_URL = 'http://localhost:8000';
			
			// Application state
			let currentView = 'table';
			let selectedLeads = [];
			let allLeads = [];
			let filteredLeads = [];
			let activeFilters = {
				search: '',
				quickFilters: [],
				companySize: [],
				matchScore: 0,
				industries: [],
				location: '',
				sort: 'match-high'
			};

			// Helper function for API calls
			async function apiCall(endpoint, method = 'GET', data = null) {
				try {
					const options = {
						method,
						headers: {
							'Content-Type': 'application/json',
						}
					};
					
					if (data) {
						options.body = JSON.stringify(data);
					}
					
					const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
					
					if (!response.ok) {
						const errorData = await response.json().catch(() => ({ detail: response.statusText }));
						throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
					}
					
					return await response.json();
				} catch (error) {
					console.error('[API] Error:', error);
					throw error;
				}
			}

			// Load results from API
			async function loadResults() {
				try {
					// Get run ID from URL or use default
					const urlParams = new URLSearchParams(window.location.search);
					const runId = urlParams.get('run_id');
					
					if (runId) {
						const run = await apiCall(`/api/capture/runs/${runId}`);
						
						// Update page info
						document.getElementById('result-source').textContent = run.linkedin_url || 'N/A';
						document.getElementById('result-criteria').textContent = run.ai_criteria || 'N/A';
						if (run.created_at) {
							const date = new Date(run.created_at);
							document.getElementById('result-created').textContent = date.toLocaleString();
						}
						
						// Load leads for this run
						const leadsResponse = await apiCall(`/api/capture/runs/${runId}/leads`);
						allLeads = leadsResponse.leads || [];
					} else {
						// Load all leads or use mock data for demo
						allLeads = [];
					}
					
					applyFilters();
				} catch (error) {
					console.error('[Results] Error loading results:', error);
					// Use empty state
					allLeads = [];
					applyFilters();
				}
			}

			// Copy source URL
			function copySource() {
				const source = document.getElementById('result-source').textContent;
				navigator.clipboard.writeText(source).then(() => {
					// Show toast notification
					alert('Source URL copied to clipboard');
				});
			}

			// Close intro block
			function closeIntroBlock() {
				document.getElementById('intro-block').classList.add('hidden');
				localStorage.setItem('intro-block-closed', 'true');
			}

			// Check if intro block should be shown
			function checkIntroBlock() {
				if (localStorage.getItem('intro-block-closed') === 'true') {
					document.getElementById('intro-block').classList.add('hidden');
				}
			}

			// Toggle quick filter
			function toggleQuickFilter(filter) {
				const btn = document.querySelector(`[data-filter="${filter}"]`);
				const index = activeFilters.quickFilters.indexOf(filter);
				
				if (index > -1) {
					activeFilters.quickFilters.splice(index, 1);
					btn.classList.remove('bg-primary', 'text-white');
					btn.classList.add('border-border', 'dark:border-darkborder');
				} else {
					activeFilters.quickFilters.push(filter);
					btn.classList.add('bg-primary', 'text-white');
					btn.classList.remove('border-border', 'dark:border-darkborder');
				}
				
				applyFilters();
			}

			// Toggle company size
			function toggleCompanySize(size) {
				const btn = document.querySelector(`[data-size="${size}"]`);
				const index = activeFilters.companySize.indexOf(size);
				
				if (index > -1) {
					activeFilters.companySize.splice(index, 1);
					btn.classList.remove('bg-primary', 'text-white');
					btn.classList.add('border-border', 'dark:border-darkborder');
				} else {
					activeFilters.companySize.push(size);
					btn.classList.add('bg-primary', 'text-white');
					btn.classList.remove('border-border', 'dark:border-darkborder');
				}
				
				applyFilters();
			}

			// Update match score
			function updateMatchScore(value) {
				activeFilters.matchScore = parseInt(value);
				document.getElementById('match-score-value').textContent = `≥ ${value}`;
				applyFilters();
			}

			// Apply filters
			function applyFilters() {
				// Get search input
				activeFilters.search = document.getElementById('search-input').value.toLowerCase();
				
				// Get location input
				activeFilters.location = document.getElementById('location-input').value.toLowerCase();
				
				// Get selected industries
				activeFilters.industries = Array.from(document.querySelectorAll('.industry-checkbox:checked')).map(cb => cb.value);
				
				// Get sort option
				activeFilters.sort = document.getElementById('sort-select').value;
				
				// Filter leads
				filteredLeads = allLeads.filter(lead => {
					// Search filter
					if (activeFilters.search) {
						const searchText = `${lead.name || ''} ${lead.title || ''} ${lead.company || ''}`.toLowerCase();
						if (!searchText.includes(activeFilters.search)) {
							return false;
						}
					}
					
					// Quick filters
					if (activeFilters.quickFilters.includes('good-fit') && (lead.match_score || 0) < 80) {
						return false;
					}
					if (activeFilters.quickFilters.includes('us-only') && lead.location && !lead.location.toLowerCase().includes('united states') && !lead.location.toLowerCase().includes('us')) {
						return false;
					}
					if (activeFilters.quickFilters.includes('smb')) {
						const size = parseInt(lead.company_size || 0);
						if (size < 11 || size > 200) {
							return false;
						}
					}
					if (activeFilters.quickFilters.includes('enterprise')) {
						const size = parseInt(lead.company_size || 0);
						if (size < 1001) {
							return false;
						}
					}
					
					// Company size filter
					if (activeFilters.companySize.length > 0) {
						const size = parseInt(lead.company_size || 0);
						let matches = false;
						activeFilters.companySize.forEach(range => {
							if (range === '1-10' && size >= 1 && size <= 10) matches = true;
							if (range === '11-50' && size >= 11 && size <= 50) matches = true;
							if (range === '51-200' && size >= 51 && size <= 200) matches = true;
							if (range === '201-500' && size >= 201 && size <= 500) matches = true;
							if (range === '501-1000' && size >= 501 && size <= 1000) matches = true;
							if (range === '1001-5000' && size >= 1001 && size <= 5000) matches = true;
							if (range === '5001+' && size >= 5001) matches = true;
						});
						if (!matches) return false;
					}
					
					// Match score filter
					if ((lead.match_score || 0) < activeFilters.matchScore) {
						return false;
					}
					
					// Industry filter
					if (activeFilters.industries.length > 0 && lead.industry) {
						if (!activeFilters.industries.includes(lead.industry)) {
							return false;
						}
					}
					
					// Location filter
					if (activeFilters.location && lead.location) {
						if (!lead.location.toLowerCase().includes(activeFilters.location)) {
							return false;
						}
					}
					
					return true;
				});
				
				// Sort leads
				filteredLeads.sort((a, b) => {
					switch (activeFilters.sort) {
						case 'match-high':
							return (b.match_score || 0) - (a.match_score || 0);
						case 'match-low':
							return (a.match_score || 0) - (b.match_score || 0);
						case 'name-asc':
							return (a.name || '').localeCompare(b.name || '');
						case 'name-desc':
							return (b.name || '').localeCompare(a.name || '');
						case 'company-asc':
							return (a.company || '').localeCompare(b.company || '');
						case 'company-desc':
							return (b.company || '').localeCompare(a.company || '');
						default:
							return 0;
					}
				});
				
				// Update UI
				updateResultsDisplay();
			}

			// Update results display
			function updateResultsDisplay() {
				const resultsCount = document.getElementById('results-count');
				resultsCount.textContent = `${filteredLeads.length} results • ${selectedLeads.length} selected`;
				
				const emptyState = document.getElementById('empty-state');
				const tableView = document.getElementById('table-view');
				const cardsView = document.getElementById('cards-view');
				
				if (filteredLeads.length === 0) {
					emptyState.classList.remove('hidden');
					tableView.classList.add('hidden');
					cardsView.classList.add('hidden');
				} else {
					emptyState.classList.add('hidden');
					
					if (currentView === 'table') {
						tableView.classList.remove('hidden');
						cardsView.classList.add('hidden');
						renderTableView();
					} else {
						tableView.classList.add('hidden');
						cardsView.classList.remove('hidden');
						renderCardsView();
					}
				}
			}

			// Render table view
			function renderTableView() {
				const tbody = document.getElementById('results-table-body');
				tbody.innerHTML = filteredLeads.map(lead => `
					<tr class="hover:bg-lightprimary dark:hover:bg-darkprimary transition-colors">
						<td class="px-4 py-3">
							<input type="checkbox" class="lead-checkbox" value="${lead.id}" onchange="toggleLeadSelection('${lead.id}')" ${selectedLeads.includes(lead.id) ? 'checked' : ''}>
						</td>
						<td class="px-4 py-3 text-sm text-dark dark:text-white font-medium">${escapeHtml(lead.name || 'N/A')}</td>
						<td class="px-4 py-3 text-sm text-link dark:text-darklink">${escapeHtml(lead.title || 'N/A')}</td>
						<td class="px-4 py-3 text-sm text-dark dark:text-white">${escapeHtml(lead.company || 'N/A')}</td>
						<td class="px-4 py-3 text-sm text-link dark:text-darklink">${lead.company_size || 'N/A'}</td>
						<td class="px-4 py-3 text-sm text-link dark:text-darklink">${escapeHtml(lead.industry || 'N/A')}</td>
						<td class="px-4 py-3 text-sm text-link dark:text-darklink">${escapeHtml(lead.location || 'N/A')}</td>
						<td class="px-4 py-3 text-sm">
							<span class="px-2 py-1 rounded text-xs font-medium ${getMatchScoreClass(lead.match_score || 0)}">
								${lead.match_score || 0}%
							</span>
						</td>
						<td class="px-4 py-3 text-sm">
							${lead.linkedin_url ? `<a href="${escapeHtml(lead.linkedin_url)}" target="_blank" class="text-primary hover:underline">View</a>` : 'N/A'}
						</td>
					</tr>
				`).join('');
			}

			// Render cards view
			function renderCardsView() {
				const container = document.getElementById('results-cards-container');
				container.innerHTML = filteredLeads.map(lead => `
					<div class="card hover:shadow-lg transition-shadow">
						<div class="card-body">
							<div class="flex items-start justify-between mb-3">
								<div class="flex-1">
									<h4 class="font-semibold text-dark dark:text-white mb-1">${escapeHtml(lead.name || 'N/A')}</h4>
									<p class="text-sm text-link dark:text-darklink">${escapeHtml(lead.title || 'N/A')}</p>
								</div>
								<input type="checkbox" class="lead-checkbox" value="${lead.id}" onchange="toggleLeadSelection('${lead.id}')" ${selectedLeads.includes(lead.id) ? 'checked' : ''}>
							</div>
							<div class="space-y-2 text-sm">
								<div>
									<span class="text-link dark:text-darklink">Company:</span>
									<span class="text-dark dark:text-white ml-2">${escapeHtml(lead.company || 'N/A')}</span>
								</div>
								<div>
									<span class="text-link dark:text-darklink">Size:</span>
									<span class="text-dark dark:text-white ml-2">${lead.company_size || 'N/A'}</span>
								</div>
								<div>
									<span class="text-link dark:text-darklink">Industry:</span>
									<span class="text-dark dark:text-white ml-2">${escapeHtml(lead.industry || 'N/A')}</span>
								</div>
								<div>
									<span class="text-link dark:text-darklink">Location:</span>
									<span class="text-dark dark:text-white ml-2">${escapeHtml(lead.location || 'N/A')}</span>
								</div>
								<div class="flex items-center justify-between pt-2 border-t border-border dark:border-darkborder">
									<span class="px-2 py-1 rounded text-xs font-medium ${getMatchScoreClass(lead.match_score || 0)}">
										Match: ${lead.match_score || 0}%
									</span>
									${lead.linkedin_url ? `<a href="${escapeHtml(lead.linkedin_url)}" target="_blank" class="text-primary hover:underline text-sm">View LinkedIn</a>` : ''}
								</div>
							</div>
						</div>
					</div>
				`).join('');
			}

			// Get match score class
			function getMatchScoreClass(score) {
				if (score >= 80) return 'bg-lightsuccess dark:bg-darksuccess text-success';
				if (score >= 60) return 'bg-lightwarning dark:bg-darkwarning text-warning';
				return 'bg-lightdanger dark:bg-darkdanger text-danger';
			}

			// Toggle lead selection
			function toggleLeadSelection(leadId) {
				const index = selectedLeads.indexOf(leadId);
				if (index > -1) {
					selectedLeads.splice(index, 1);
				} else {
					selectedLeads.push(leadId);
				}
				updateResultsDisplay();
			}

			// Toggle select all
			function toggleSelectAll(checked) {
				if (checked) {
					selectedLeads = filteredLeads.map(lead => lead.id);
				} else {
					selectedLeads = [];
				}
				document.querySelectorAll('.lead-checkbox').forEach(cb => cb.checked = checked);
				updateResultsDisplay();
			}

			// Select all
			function selectAll() {
				selectedLeads = filteredLeads.map(lead => lead.id);
				document.querySelectorAll('.lead-checkbox').forEach(cb => cb.checked = true);
				document.getElementById('select-all-checkbox').checked = true;
				updateResultsDisplay();
			}

			// Tag selected
			function tagSelected() {
				if (selectedLeads.length === 0) {
					alert('Please select at least one lead');
					return;
				}
				alert(`Tagging ${selectedLeads.length} selected lead(s)`);
			}

			// Set view
			function setView(view) {
				currentView = view;
				const tableBtn = document.getElementById('view-table-btn');
				const cardsBtn = document.getElementById('view-cards-btn');
				
				if (view === 'table') {
					tableBtn.classList.add('bg-primary', 'text-white');
					tableBtn.classList.remove('text-link', 'dark:text-darklink');
					cardsBtn.classList.remove('bg-primary', 'text-white');
					cardsBtn.classList.add('text-link', 'dark:text-darklink');
				} else {
					cardsBtn.classList.add('bg-primary', 'text-white');
					cardsBtn.classList.remove('text-link', 'dark:text-darklink');
					tableBtn.classList.remove('bg-primary', 'text-white');
					tableBtn.classList.add('text-link', 'dark:text-darklink');
				}
				
				updateResultsDisplay();
			}

			// Reset all filters
			function resetAllFilters() {
				activeFilters = {
					search: '',
					quickFilters: [],
					companySize: [],
					matchScore: 0,
					industries: [],
					location: '',
					sort: 'match-high'
				};
				
				document.getElementById('search-input').value = '';
				document.getElementById('location-input').value = '';
				document.getElementById('match-score-slider').value = 0;
				document.getElementById('match-score-value').textContent = '≥ 0';
				document.getElementById('sort-select').value = 'match-high';
				
				document.querySelectorAll('.quick-filter-btn').forEach(btn => {
					btn.classList.remove('bg-primary', 'text-white');
					btn.classList.add('border-border', 'dark:border-darkborder');
				});
				
				document.querySelectorAll('.company-size-btn').forEach(btn => {
					btn.classList.remove('bg-primary', 'text-white');
					btn.classList.add('border-border', 'dark:border-darkborder');
				});
				
				document.querySelectorAll('.industry-checkbox').forEach(cb => cb.checked = false);
				
				applyFilters();
			}

			// Escape HTML
			function escapeHtml(text) {
				if (!text) return '';
				const div = document.createElement('div');
				div.textContent = text;
				return div.innerHTML;
			}

			// Initialize on page load
			document.addEventListener('DOMContentLoaded', function() {
				checkIntroBlock();
				loadResults();
				
				// Add search input listener
				document.getElementById('search-input').addEventListener('input', applyFilters);
				document.getElementById('location-input').addEventListener('input', applyFilters);
			});
		</script>
	</body>
</html>
